<!DOCTYPE html>
<html>
<head>
    <title>Round Avatar</title>
    <meta charset="gbk">
    <script src="http://a.tbcdn.cn/s/kissy/1.2.0/kissy.js" charset="gbk"></script>
	<link href="../assets/css/tb-reset.css" rel="stylesheet">
	<link href="../assets/css/bootstrap.css" rel="stylesheet">
    <link rel="stylesheet" href="css/css3transition.css"/>
	<!-- 体验考虑，vml在ie下js需提前加载 -->
    <!--[if lt IE 9]>
    <link rel="stylesheet" href="css/header-ie.css"/>
    <script src="http://a.tbcdn.cn/p/sns/1.1/util/round-vml.js"></script>
    <![endif]-->
</head>

<body>
<div qz="module" id="qz-header" class="qz-header clearfix">
    <div class="header-content">
          <ul id="J_RoundVml" class="create-group">
            <li class="member-wrap" url-data="http://www.google.cn">
                <i class="cur-arrow"></i>

                <div class="avatar-wrap"></div>
                <div class="membe-number">
                    <div class="txt">
                        <p>组名组名组名..</p>
                    </div>
                </div>
                <div class="avatar">
                    <s class="avatar-1" href="#" style="background-image:url(http://img.f2e.taobao.net/img.png?x=100)">头像</s>
                    <s class="avatar-2" href="#" style="background-image:url(http://img.f2e.taobao.net/img.png?x=100)">头像</s>
                    <s class="avatar-3" href="#" style="background-image:url(http://img.f2e.taobao.net/img.png?x=100)">头像</s>
                    <s class="avatar-4" href="#" style="background-image:url(http://img.f2e.taobao.net/img.png?x=100)">头像</s>
                    <s class="avatar-5" href="#" style="background-image:url(http://img.f2e.taobao.net/img.png?x=100)">头像</s>
                    <s class="avatar-6" href="#">头像</s>
                    <s class="avatar-7" href="#">头像</s>
                    <s class="avatar-8" href="#">头像</s>
                </div>
            </li>
            <li class="member-wrap" url-data="http://www.google.cn">
                <div class="avatar-wrap"></div>
                <div class="membe-number">
                    <div class="txt">
                        <p>组名组名组名..</p>
                    </div>
                </div>
                <div class="avatar">
                    <s class="avatar-1" href="#" style="background-image:url(http://img.f2e.taobao.net/img.png?x=100)">头像</s>
                    <s class="avatar-2" href="#" style="background-image:url(http://img.f2e.taobao.net/img.png?x=100)">头像</s>
                    <s class="avatar-3" href="#" style="background-image:url(http://img.f2e.taobao.net/img.png?x=100)">头像</s>
                    <s class="avatar-4" href="#" style="background-image:url(http://img.f2e.taobao.net/img.png?x=100)">头像</s>
                    <s class="avatar-5" href="#" style="background-image:url(http://img.f2e.taobao.net/img.png?x=100)">头像</s>
                    <s class="avatar-6" href="#">头像</s>
                    <s class="avatar-7" href="#">头像</s>
                    <s class="avatar-8" href="#">头像</s>
                </div>
            </li>
            <li class="member-wrap" url-data="http://www.google.cn">
                <div class="avatar-wrap"></div>
                <div class="membe-number">
                    <div class="txt">
                        <p>组名组名组名..</p>
                    </div>
                </div>
                <div class="avatar">
                    <s class="avatar-1" href="#" style="background-image:url(http://img.f2e.taobao.net/img.png?x=100)">头像</s>
                    <s class="avatar-2" href="#" style="background-image:url(http://img.f2e.taobao.net/img.png?x=100)">头像</s>
                    <s class="avatar-3" href="#" style="background-image:url(http://img.f2e.taobao.net/img.png?x=100)">头像</s>
                    <s class="avatar-4" href="#" style="background-image:url(http://img.f2e.taobao.net/img.png?x=100)">头像</s>
                    <s class="avatar-5" href="#" style="background-image:url(http://img.f2e.taobao.net/img.png?x=100)">头像</s>
                    <s class="avatar-6" href="#">头像</s>
                    <s class="avatar-7" href="#">头像</s>
                    <s class="avatar-8" href="#">头像</s>
                </div>
            </li>
            <li class="member-wrap" url-data="http://www.google.cn">
                <div class="avatar-wrap"></div>
                <div class="membe-number">
                    <div class="txt">
                        <p>组名组名组名..</p>
                    </div>
                </div>
                <div class="avatar">
                    <s class="avatar-1" href="#" style="background-image:url(http://img.f2e.taobao.net/img.png?x=100)">头像</s>
                    <s class="avatar-2" href="#" style="background-image:url(http://img.f2e.taobao.net/img.png?x=100)">头像</s>
                    <s class="avatar-3" href="#" style="background-image:url(http://img.f2e.taobao.net/img.png?x=100)">头像</s>
                    <s class="avatar-4" href="#" style="background-image:url(http://img.f2e.taobao.net/img.png?x=100)">头像</s>
                    <s class="avatar-5" href="#" style="background-image:url(http://img.f2e.taobao.net/img.png?x=100)">头像</s>
                    <s class="avatar-6" href="#">头像</s>
                    <s class="avatar-7" href="#">头像</s>
                    <s class="avatar-8" href="#">头像</s>
                </div>
            </li>
        </ul>
   </div>
</div>
<!--[if lt IE 9]>
<script>KISSY.use('util/round-vml', function (S, roundVML) {
	//ie下圆形头像兼容代码
	roundVML.init('#J_RoundVml s');
});</script>
<![endif]-->

<script>
//css3动态效果
KISSY.add('hover',function(S) {
	var $ = S.all;
    var avatarGroup = {
   		/**
		 * 返回目标节点
		 * return {Array} nodes
		 */
   		targetNodes : function(targetCls) {
   			var tempNodes = $(targetCls);
   			return tempNodes.length?tempNodes:null;
   		},
   		/**
		 * 头像hover方法 to ie6
		 * @param {string} targetCls node的selector
		 */		
    	_hover : function(targetCls){
			var nodes = this.targetNodes(targetCls);
			if(nodes){
				nodes.on('mouseenter mouseleave',this._mouseEventCallBack)
			}
    	},
   		/**
		 * 头像click方法 整个区域可点击
		 * @param {string} targetCls node的selector
		 */		
    	_click : function(targetCls){
			var nodes = this.targetNodes(targetCls);
			if(nodes){
				nodes.on('click',this._clickEventCallBack)
			}
    	},	
    	/*
    	 * 头像点击事件回调
		 * @param {event} ev 事件对象
    	 */
		_clickEventCallBack : function(ev) {
			var node = $(ev.currentTarget),
				linkHref = node.attr('url-data');
			if(!linkHref) return;
			//获取链接
			window.location.href = linkHref;
		},
    	/*
    	 * 头像鼠悬浮事件回调
		 * @param {event} ev 事件对象
    	 */
		_mouseEventCallBack : function(ev) {
			var node = $(ev.currentTarget);
			if(ev.type == 'mouseenter'){
				node.addClass('avatar-wrap-hover');
			}else if(ev.type == 'mouseleave'){
				node.removeClass('avatar-wrap-hover');
			}
		},
    	/*
    	 * 创建新组
    	 */
    	bindEvent : function(targetCls){
    		var node = this.targetNodes(targetCls);
    		var self = this;
    		if(node){
    			node.on('click',self.exeAddEvent);
    		}
    	},
    	/*
    	 * css3动态效果
		 * 高浏览器支持
    	 */
    	circleTransition : function(targetCls){
			var node = this.targetNodes(targetCls);
			if(!node) return;

			node.on('mouseenter mouseleave',function(ev){
				var node = $(ev.currentTarget);
				if(ev.type == 'mouseenter'){
					node.prev().prev().addClass('scale');
					node.addClass('show');
					node.parent('.member-wrap').removeClass('small-avatar');
				}else if(ev.type == 'mouseleave'){
					node.prev().prev().removeClass('scale');
					node.removeClass('show');
					node.parent('.member-wrap').addClass('small-avatar');
				}
			})
    	},
		circleIe9 : function(targetCls){
			var node = this.targetNodes(targetCls);
			if(!node) return;
			node.on('mouseenter mouseleave',function(ev){
				var node = $(ev.currentTarget);
				if(ev.type == 'mouseenter'){
					node.parent('.membe-number').prev().addClass('scale');
					node.parent('.membe-number').next().addClass('show');
					node.parent('.member-wrap').removeClass('small-avatar');
				}else if(ev.type == 'mouseleave'){
					node.parent('.membe-number').prev().removeClass('scale');
					node.parent('.membe-number').next().removeClass('show');
					node.parent('.member-wrap').addClass('small-avatar');
				}

			})
			
		},
    	/*
    	 * css3动态效果
		 * 高浏览器支持
    	 */
		 removeSmallCir : function(targetCls) {
			var nodes = this.targetNodes(targetCls);
			if(!nodes) return;
			nodes.addClass('small-avatar');
		 },
		/*
    	 * ie下 vml需要js动态添加visibility
		 * 高浏览器支持
    	 */
    	circleHover: function(targetCls){
			var node = this.targetNodes(targetCls);
			if(!node) return;

			node.on('mouseenter mouseleave',function(ev){
				var node = $(ev.currentTarget);
				if(ev.type == 'mouseenter'){
					node.all('.roundrect').css('visibility','visible');
				}else if(ev.type == 'mouseleave'){
					node.all('.roundrect').css('visibility','hidden');
				}
			})
    	}
    }
	return {
   		init : function(){
			if(S.UA.ie == 6 || S.UA.ie == 7 || S.UA.ie == 8){
				avatarGroup.circleHover('#J_RoundVml .member-wrap');
			}else{
				//头像动态效果，css3支持
				avatarGroup.removeSmallCir('#J_RoundVml .member-wrap');
				avatarGroup.circleTransition('#J_RoundVml .avatar');	
			}
			if(S.UA.ie == 9) {
				avatarGroup.circleIe9('#J_RoundVml .txt');//解决元素绝对定位无法覆盖文本，倒是事件需要额外绑定
			}
   		}
	}
})

KISSY.use('hover',function(S,Hover){
	Hover.init();	
})
</script>
</body>
</html>
